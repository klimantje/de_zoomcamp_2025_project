id: dbt-duckdb
namespace: system

tasks:
  - id: dbt
    type: io.kestra.plugin.core.flow.WorkingDirectory
    tasks:
      - id: clone_repository
        type: io.kestra.plugin.git.Clone
        url: https://github.com/klimantje/de_zoomcamp_2025_project
        branch: feature/loading_data
        username: "{{ secret('GITHUB_USER') }}"
        password: "{{ secret('GITHUB_PAT') }}"

      - id: dbt_build
        type: io.kestra.plugin.dbt.cli.DbtCLI
        taskRunner:
          type: io.kestra.plugin.scripts.runner.docker.Docker
        containerImage: ghcr.io/kestra-io/dbt-duckdb:latest
        projectDir: bike_rentals
        commands:
          - dbt build --project-dir bike_rentals